<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 1 - 12-dars: Ob-havo</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f9ff;
        }
        /* Flip Card CSS */
        .perspective-1000 {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        .correct-anim {
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Chat Bubble Animation */
        .chat-anim {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Data & Assets ---

        // Reordered: New words first (Today, Tomorrow, You, Good, No)
        const vocabulary = [
            { id: 15, char: '‰ªäÂ§©', pinyin: 'jƒ´ntiƒÅn', uzbek: 'Bugun', icon: 'today' }, 
            { id: 16, char: 'ÊòéÂ§©', pinyin: 'm√≠ngtiƒÅn', uzbek: 'Ertaga', icon: 'tomorrow' },
            { id: 19, char: 'Êò®Â§©', pinyin: 'zu√≥tiƒÅn', uzbek: 'Kecha', icon: 'yesterday' }, 
            { id: 17, char: '‰Ω†', pinyin: 'n«ê', uzbek: 'Siz/Sen', icon: 'you' },
            { id: 14, char: 'Â•Ω', pinyin: 'h«éo', uzbek: 'Yaxshi', icon: 'good' },
            { id: 18, char: '‰∏ç', pinyin: 'b√π', uzbek: "Yo'q / Emas", icon: 'no' }, 
            { id: 1, char: 'Â§©Ê∞î', pinyin: 'tiƒÅnq√¨', uzbek: 'Ob-havo', icon: 'weather' },
            { id: 2, char: 'ÊÄé‰πàÊ†∑', pinyin: 'zƒõnmey√†ng', uzbek: 'Qanday', icon: 'question' },
            { id: 3, char: 'Â§™', pinyin: 't√†i', uzbek: 'Juda', icon: 'exclaim' },
            { id: 4, char: 'ÁÉ≠', pinyin: 'r√®', uzbek: 'Issiq', icon: 'hot' },
            { id: 5, char: 'ÂÜ∑', pinyin: 'lƒõng', uzbek: 'Sovuq', icon: 'cold' },
            { id: 9, char: 'Ë∫´‰Ωì', pinyin: 'shƒìnt«ê', uzbek: 'Badan/Sog\'liq', icon: 'body' },
        ];

        // --- SVG Components ---
        const Icons = ({ name, className }) => {
            const props = { className: className, fill: "currentColor", viewBox: "0 0 24 24" };
            switch (name) {
                case 'weather': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                );
                case 'hot': return (
                    <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <circle cx="12" cy="12" r="5" className="text-orange-500" fill="orange" fillOpacity="0.2"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="orange" />
                    </svg>
                );
                case 'cold': return (
                    <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M12 3v18M3 12h18M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4" className="text-blue-400" />
                        <path d="M12 3l-2 3M12 3l2 3M12 21l-2-3M12 21l2-3" className="text-blue-400"/>
                    </svg>
                );
                case 'rain': return (
                    <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M20 16.2A4.5 4.5 0 0021.428 8.375 5.3 5.3 0 0019.233 4.108 5.302 5.302 0 0013.7 3.018a7.4 7.4 0 00-3.6 1.13A7.44 7.44 0 005.007 8.356 4.502 4.502 0 006.12 16.632" stroke="#60a5fa" />
                        <path d="M16 19v2M12 20v2M8 19v2" stroke="#3b82f6" strokeLinecap="round" />
                    </svg>
                );
                case 'fruit': return (
                    <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                         <circle cx="12" cy="13" r="8" className="text-red-400" fill="currentColor" fillOpacity="0.2"/>
                         <path d="M12 5v-2M14 3l-2 2" stroke="green"/>
                    </svg>
                );
                 case 'water': return (
                    <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M12 2.69l5.74 9.94a6.63 6.63 0 11-11.48 0L12 2.69z" className="text-blue-500" fill="currentColor" fillOpacity="0.2"/>
                    </svg>
                );
                case 'question': return (
                     <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                );
                case 'heart': return (
                    <svg {...props} fill="currentColor" viewBox="0 0 24 24" className="text-red-500">
                        <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" />
                    </svg>
                );
                case 'body': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                );
                case 'exclaim': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                );
                case 'come': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                    </svg>
                );
                case 'lady': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                );
                case 'some': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z" />
                    </svg>
                );
                case 'good': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                    </svg>
                );
                case 'today': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                        <text x="12" y="19" fontSize="6" textAnchor="middle" fill="currentColor" stroke="none">1</text>
                    </svg>
                );
                case 'tomorrow': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                        <path d="M13 16l3 0m0 0l-1.5 -1.5m1.5 1.5l-1.5 1.5" strokeLinecap="round" strokeLinejoin="round" />
                    </svg>
                );
                case 'yesterday': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        <path d="M12 2V4M12 20V22M4 12H2M22 12H20" strokeOpacity="0.3" />
                    </svg>
                );
                case 'city': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-3a1 1 0 011-1h2a1 1 0 011 1v3" />
                    </svg>
                );
                case 'you': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <circle cx="12" cy="8" r="4" />
                        <path d="M6 20v-2a6 6 0 0112 0v2" strokeLinecap="round" strokeLinejoin="round"/>
                         <path d="M12 14v4M9 16l3 2 3-2" strokeLinecap="round" strokeLinejoin="round" className="text-teal-500 opacity-50"/>
                    </svg>
                );
                case 'no': return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="3">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" className="text-red-500" />
                    </svg>
                );
                case 'user': return (
                    <svg {...props} fill="currentColor" viewBox="0 0 24 24">
                        <path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd" />
                    </svg>
                );
                default: return (
                    <svg {...props} fill="none" stroke="currentColor" strokeWidth="2">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                );
            }
        };

        // --- TTS Helper ---
        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8; // Slightly slower for beginners
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- Components ---

        const Header = ({ setView, currentView }) => (
            <div className="bg-teal-600 text-white p-4 shadow-md sticky top-0 z-50">
                <div className="max-w-4xl mx-auto flex justify-between items-center">
                    <div className="flex items-center space-x-2">
                        <Icons name="weather" className="w-8 h-8" />
                        <div>
                            <h1 className="text-xl font-bold">HSK 1 - 12-dars: ÊòéÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑</h1>
                            <p className="text-xs text-teal-100">ertaga ob-havo qandayÔºü M√≠ngtiƒÅn tiƒÅnq√¨ zƒõnmey√†ng</p>
                        </div>
                    </div>
                    {/* Added contact info */}
                    <div className="text-right hidden sm:block">
                        <p className="text-xs font-semibold text-teal-50">Dilfuza KƒÅng l«éo shƒ´ bilan xitoy tilini o'rganmiz</p>
                    </div>
                </div>
                <div className="max-w-4xl mx-auto mt-4 flex space-x-1 overflow-x-auto pb-2">
                    {['vocab', 'dialogue', 'grammar', 'gaptuzish', 'practice'].map((view) => (
                        <button
                            key={view}
                            onClick={() => setView(view)}
                            className={`px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${
                                currentView === view 
                                ? 'bg-white text-teal-700' 
                                : 'bg-teal-700 text-teal-100 hover:bg-teal-500'
                            }`}
                        >
                            {view === 'vocab' && "So'zlar (Lug'at)"}
                            {view === 'dialogue' && "Suhbat (Dialogue)"}
                            {view === 'grammar' && "Grammatika"}
                            {view === 'gaptuzish' && "Gap tuzish"}
                            {view === 'practice' && "Mashq (Sinov)"}
                        </button>
                    ))}
                </div>
            </div>
        );

        const VocabCard = ({ item }) => {
            const [isFlipped, setIsFlipped] = useState(false);

            const handleClick = () => {
                setIsFlipped(!isFlipped);
                speak(item.char);
            };

            return (
                <div 
                    className="h-64 cursor-pointer perspective-1000 group" 
                    onClick={handleClick}
                >
                    <div className={`relative w-full h-full transition-transform duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                        
                        {/* Front: Pinyin + Icon */}
                        <div className="absolute w-full h-full bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col items-center justify-center backface-hidden">
                            <div className="w-20 h-20 mb-6 bg-teal-50 rounded-full flex items-center justify-center text-teal-600">
                                <Icons name={item.icon} className="w-12 h-12" />
                            </div>
                            <h3 className="text-3xl font-bold text-teal-700 mb-2">{item.pinyin}</h3>
                            <p className="text-xs text-gray-400 mt-4 absolute bottom-4">Bosing (Click to flip)</p>
                        </div>

                        {/* Back: Hanzi + Uzbek */}
                        <div className="absolute w-full h-full bg-teal-600 rounded-xl shadow-sm border border-teal-700 p-6 flex flex-col items-center justify-center backface-hidden rotate-y-180 text-white">
                            <h3 className="text-5xl font-bold mb-4">{item.char}</h3>
                            <div className="w-12 h-1 bg-teal-400 mb-4 rounded-full"></div>
                            <p className="text-xl font-bold">{item.uzbek}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const VocabularySection = () => (
            <div className="p-4 max-w-4xl mx-auto">
                <div className="mb-6 bg-blue-50 border-l-4 border-blue-500 p-4 text-blue-700">
                    <p className="font-bold">Yo'riqnoma (Instruction):</p>
                    <p className="mb-2">Kartochkani bosing va aylantiring. (Click card to flip and hear.)</p>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    {vocabulary.map(item => (
                        <VocabCard key={item.id} item={item} />
                    ))}
                </div>
            </div>
        );

        const DialogueSection = () => {
            const dialogueLines = [
                { id: 1, role: 'A', text: '‰ªäÂ§©Â°î‰ªÄÂπ≤Â§©Ê∞îÊÄé‰πàÊ†∑Ôºü', pinyin: 'Jƒ´ntiƒÅn T«ésh√≠g√†n tiƒÅnq√¨ zƒõnmey√†ng?', trans: 'Bugun Toshkentda ob-havo qanday?' },
                { id: 2, role: 'B', text: 'Â§™ÁÉ≠‰∫Ü„ÄÇ', pinyin: 'T√†i r√® le.', trans: 'Juda issiq.' },
                { id: 3, role: 'A', text: 'ÊòéÂ§©Âë¢ÔºüÊòéÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑Ôºü', pinyin: 'M√≠ngtiƒÅn ne? M√≠ngtiƒÅn tiƒÅnq√¨ zƒõnmey√†ng?', trans: 'Ertaga-chi? Ertaga ob-havo qanday?' },
                { id: 4, role: 'B', text: 'ÊòéÂ§©Â§©Ê∞îÂæàÂ•ΩÔºå‰∏çÂÜ∑‰∏çÁÉ≠„ÄÇ', pinyin: 'M√≠ngtiƒÅn tiƒÅnq√¨ hƒõn h«éo, b√π lƒõng b√∫ r√®.', trans: 'Ertaga ob-havo juda yaxshi, sovuq ham emas, issiq ham emas.' },
            ];

            return (
                <div className="p-4 max-w-2xl mx-auto">
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col min-h-[500px]">
                        <div className="bg-teal-50 p-4 border-b border-teal-100 flex items-center justify-between">
                            <h2 className="font-bold text-teal-800 text-lg">Muloqot (Dialogue)</h2>
                            <span className="text-xs text-teal-600 bg-white px-2 py-1 rounded-full border border-teal-200">12-1: Âú®Ë∑Ø‰∏ä (Yo'lda)</span>
                        </div>
                        
                        <div className="flex-1 p-4 space-y-6 overflow-y-auto bg-gray-50">
                            {dialogueLines.map((line, index) => (
                                <div 
                                    key={line.id} 
                                    className={`flex w-full ${line.role === 'B' ? 'justify-end' : 'justify-start'} chat-anim`}
                                    style={{animationDelay: `${index * 0.2}s`}}
                                    onClick={() => speak(line.text)}
                                >
                                    <div className={`flex max-w-[85%] ${line.role === 'B' ? 'flex-row-reverse' : 'flex-row'}`}>
                                        {/* Avatar */}
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${line.role === 'A' ? 'bg-blue-100 text-blue-600 mr-3' : 'bg-green-100 text-green-600 ml-3'}`}>
                                            <span className="font-bold text-lg">{line.role}</span>
                                        </div>
                                        
                                        {/* Bubble */}
                                        <div className={`cursor-pointer group relative p-4 rounded-2xl shadow-sm border transition-all hover:-translate-y-1 hover:shadow-md ${
                                            line.role === 'A' 
                                            ? 'bg-white border-blue-100 rounded-tl-none' 
                                            : 'bg-teal-600 border-teal-600 rounded-tr-none text-white'
                                        }`}>
                                            <p className={`text-lg font-bold mb-1 ${line.role === 'A' ? 'text-gray-800' : 'text-white'}`}>
                                                {line.pinyin}
                                            </p>
                                            <p className={`text-sm mb-2 opacity-90 ${line.role === 'A' ? 'text-gray-500' : 'text-teal-100'}`}>
                                                {line.text}
                                            </p>
                                            <div className={`text-xs border-t pt-2 mt-2 opacity-80 italic ${line.role === 'A' ? 'border-gray-100 text-gray-400' : 'border-teal-500 text-teal-100'}`}>
                                                {line.trans}
                                            </div>
                                            
                                            {/* Audio Hint Icon */}
                                            <div className={`absolute -right-1 -top-1 w-5 h-5 rounded-full flex items-center justify-center shadow-sm opacity-0 group-hover:opacity-100 transition-opacity ${line.role === 'A' ? 'bg-blue-500 text-white' : 'bg-white text-teal-600'}`}>
                                                <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" /></svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="p-4 bg-white border-t border-gray-100 text-center text-gray-400 text-sm">
                            Gapirish uchun xabarni bosing (Click message to speak)
                        </div>
                    </div>
                </div>
            );
        };

        const GrammarSection = () => {
            const [activeTab, setActiveTab] = useState('tai');
            
            const exercises = {
                tai: {
                    title: "Â§™ ... ‰∫Ü (Juda ...)",
                    subtitle: "T√†i ... le",
                    desc: (<span>Xitoy tilida "Juda [sifat]" deyish uchun <strong>Â§™ (t√†i) + Sifat + ‰∫Ü (le)</strong> konstruksiyasidan foydalanamiz.</span>),
                    examples: [
                        { char: "Â§™ÁÉ≠‰∫Ü", pinyin: "T√†i r√® le", trans: "Juda issiq", icon: "hot", color: "orange" },
                        { char: "Â§™ÂÜ∑‰∫Ü", pinyin: "T√†i lƒõng le", trans: "Juda sovuq", icon: "cold", color: "blue" },
                        { char: "Â§™Â•Ω‰∫Ü", pinyin: "T√†i h«éo le", trans: "Juda yaxshi", icon: "good", color: "green" }
                    ]
                },
                zenmeyang: {
                    title: "... ÊÄé‰πàÊ†∑? (... Qanday?)",
                    subtitle: "... zƒõnmey√†ng?",
                    desc: (<span>Biror narsa yoki holatning qandayligini so'rash uchun <strong>Ega (Subject) + ÊÄé‰πàÊ†∑?</strong> so'zidan foydalanamiz.</span>),
                    examples: [
                        { char: "Â§©Ê∞îÊÄé‰πàÊ†∑", pinyin: "TiƒÅnq√¨ zƒõnmey√†ng?", trans: "Ob-havo qanday?", icon: "weather", color: "teal" },
                        { char: "Ë∫´‰ΩìÊÄé‰πàÊ†∑", pinyin: "Shƒìnt«ê zƒõnmey√†ng?", trans: "Sog'liq qanday?", icon: "body", color: "red" },
                        { char: "‰ªäÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑", pinyin: "Jƒ´ntiƒÅn tiƒÅnq√¨ zƒõnmey√†ng?", trans: "Bugun ob-havo qanday?", icon: "today", color: "indigo" },
                        { char: "ÊòéÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑", pinyin: "M√≠ngtiƒÅn tiƒÅnq√¨ zƒõnmey√†ng?", trans: "Ertaga ob-havo qanday?", icon: "tomorrow", color: "purple" },
                        { char: "‰Ω†ÊÄé‰πàÊ†∑", pinyin: "N«ê zƒõnmey√†ng?", trans: "Siz qandaysiz?", icon: "you", color: "pink" } 
                    ]
                }
            };

            const currentEx = exercises[activeTab];

            return (
                <div className="p-4 max-w-4xl mx-auto">
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                        
                        {/* Grammar Tabs */}
                        <div className="flex border-b border-gray-200 mb-6">
                            <button 
                                onClick={() => setActiveTab('tai')}
                                className={`pb-2 px-4 text-lg font-bold transition-colors border-b-2 ${activeTab === 'tai' ? 'border-teal-600 text-teal-600' : 'border-transparent text-gray-400 hover:text-gray-600'}`}
                            >
                                Â§™...‰∫Ü (Tai...le)
                            </button>
                            <button 
                                onClick={() => setActiveTab('zenmeyang')}
                                className={`pb-2 px-4 text-lg font-bold transition-colors border-b-2 ${activeTab === 'zenmeyang' ? 'border-teal-600 text-teal-600' : 'border-transparent text-gray-400 hover:text-gray-600'}`}
                            >
                                ...ÊÄé‰πàÊ†∑? (...Zƒõnmey√†ng?)
                            </button>
                        </div>

                        <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            <span className="bg-teal-100 text-teal-800 text-sm font-semibold mr-2 px-2.5 py-0.5 rounded">Grammatika</span>
                            {currentEx.title}
                        </h2>
                        <p className="text-gray-600 mb-4">
                            {currentEx.desc}
                        </p>
                        
                        {/* Examples */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            {currentEx.examples.map((ex, idx) => (
                                <div key={idx} className={`bg-${ex.color}-50 p-4 rounded-lg border border-${ex.color}-100 cursor-pointer hover:shadow-md transition-shadow`} onClick={() => speak(ex.char)}>
                                    <div className="flex items-center space-x-2 mb-2">
                                        <Icons name={ex.icon} className={`w-6 h-6 text-${ex.color}-500`} />
                                        <span className="text-lg font-bold text-gray-800">{ex.char}</span>
                                    </div>
                                    <p className="text-gray-500 font-medium">{ex.pinyin}</p>
                                    <p className="text-gray-400 text-sm italic">({ex.trans})</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const GapTuzishSection = () => {
            const [activeTab, setActiveTab] = useState('tai');
            const [sentence, setSentence] = useState([]);
            const [feedback, setFeedback] = useState("");
            const [level, setLevel] = useState(0); 
            const [isCorrect, setIsCorrect] = useState(false); 
            
            const exercises = {
                tai: {
                    title: "Â§™ ... ‰∫Ü (Juda ...)",
                    levels: [
                        {
                            targetSentence: "Â§™ÁÉ≠‰∫Ü",
                            targetParts: ["Â§™", "ÁÉ≠", "‰∫Ü"],
                            hint: '"Juda issiq" (Too hot)',
                            options: [
                                { char: "‰∫Ü", pinyin: "le" },
                                { char: "ÁÉ≠", pinyin: "r√®" },
                                { char: "Â§™", pinyin: "t√†i" },
                                { char: "ÂÜ∑", pinyin: "lƒõng" },
                                { char: "Â•Ω", pinyin: "h«éo" } 
                            ]
                        },
                        {
                            targetSentence: "Â§™ÂÜ∑‰∫Ü",
                            targetParts: ["Â§™", "ÂÜ∑", "‰∫Ü"],
                            hint: '"Juda sovuq" (Too cold)',
                            options: [
                                { char: "ÂÜ∑", pinyin: "lƒõng" },
                                { char: "Â§™", pinyin: "t√†i" },
                                { char: "‰∫Ü", pinyin: "le" },
                                { char: "Â•Ω", pinyin: "h«éo" }
                            ]
                        },
                        {
                            targetSentence: "Â§™Â•Ω‰∫Ü",
                            targetParts: ["Â§™", "Â•Ω", "‰∫Ü"],
                            hint: '"Juda yaxshi" (Great)',
                            options: [
                                { char: "Â•Ω", pinyin: "h«éo" },
                                { char: "Â§™", pinyin: "t√†i" },
                                { char: "‰∫Ü", pinyin: "le" },
                                { char: "‰∏ç", pinyin: "b√π" }
                            ]
                        }
                    ]
                },
                zenmeyang: {
                    title: "... ÊÄé‰πàÊ†∑? (... Qanday?)",
                    levels: [
                        {
                            targetSentence: "Â§©Ê∞îÊÄé‰πàÊ†∑",
                            targetParts: ["Â§©Ê∞î", "ÊÄé‰πàÊ†∑"],
                            hint: '"Ob-havo qanday?" (How is the weather?)',
                            options: [
                                { char: "ÊÄé‰πàÊ†∑", pinyin: "zƒõnmey√†ng" },
                                { char: "Â§©Ê∞î", pinyin: "tiƒÅnq√¨" },
                                { char: "Â•Ω", pinyin: "h«éo" },
                                { char: "ÁÉ≠", pinyin: "r√®" }
                            ]
                        },
                        {
                            targetSentence: "Ë∫´‰ΩìÊÄé‰πàÊ†∑",
                            targetParts: ["Ë∫´‰Ωì", "ÊÄé‰πàÊ†∑"],
                            hint: '"Sog\'liq qanday?" (How is health?)',
                            options: [
                                { char: "ÊÄé‰πàÊ†∑", pinyin: "zƒõnmey√†ng" },
                                { char: "Ë∫´‰Ωì", pinyin: "shƒìnt«ê" },
                                { char: "Â•Ω", pinyin: "h«éo" },
                                { char: "Êù•", pinyin: "l√°i" }
                            ]
                        },
                        {
                            targetSentence: "‰ªäÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑",
                            targetParts: ["‰ªäÂ§©", "Â§©Ê∞î", "ÊÄé‰πàÊ†∑"],
                            hint: '"Bugun ob-havo qanday?" (How is the weather today?)',
                            options: [
                                { char: "ÊÄé‰πàÊ†∑", pinyin: "zƒõnmey√†ng" },
                                { char: "Â§©Ê∞î", pinyin: "tiƒÅnq√¨" },
                                { char: "‰ªäÂ§©", pinyin: "jƒ´ntiƒÅn" },
                                { char: "ÊòéÂ§©", pinyin: "m√≠ngtiƒÅn" }
                            ]
                        },
                        {
                            targetSentence: "ÊòéÂ§©Â§©Ê∞îÊÄé‰πàÊ†∑",
                            targetParts: ["ÊòéÂ§©", "Â§©Ê∞î", "ÊÄé‰πàÊ†∑"],
                            hint: '"Ertaga ob-havo qanday?" (How is the weather tomorrow?)',
                            options: [
                                { char: "ÊÄé‰πàÊ†∑", pinyin: "zƒõnmey√†ng" },
                                { char: "Â§©Ê∞î", pinyin: "tiƒÅnq√¨" },
                                { char: "‰ªäÂ§©", pinyin: "jƒ´ntiƒÅn" },
                                { char: "ÊòéÂ§©", pinyin: "m√≠ngtiƒÅn" }
                            ]
                        },
                        {
                            targetSentence: "‰Ω†ÊÄé‰πàÊ†∑",
                            targetParts: ["‰Ω†", "ÊÄé‰πàÊ†∑"],
                            hint: '"Siz qandaysiz?" (How are you?)',
                            options: [
                                { char: "ÊÄé‰πàÊ†∑", pinyin: "zƒõnmey√†ng" },
                                { char: "‰Ω†", pinyin: "n«ê" },
                                { char: "Â•Ω", pinyin: "h«éo" },
                                { char: "Â§©Ê∞î", pinyin: "tiƒÅnq√¨" }
                            ]
                        }
                    ]
                }
            };

            const currentEx = exercises[activeTab];
            const safeLevel = (level < currentEx.levels.length) ? level : 0;
            const currentLevelData = currentEx.levels[safeLevel];
            const totalLevels = currentEx.levels.length;

            const handleTabSwitch = (newTab) => {
                setActiveTab(newTab);
                setLevel(0);
                setSentence([]);
                setFeedback("");
                setIsCorrect(false);
            };

            const handleAdd = (char) => {
                if (isCorrect) return;

                if (sentence.length < currentLevelData.targetParts.length) {
                    const newSentence = [...sentence, char];
                    setSentence(newSentence);
                    speak(char);
                    
                    if (newSentence.length === currentLevelData.targetParts.length) {
                        if (newSentence.join('') === currentLevelData.targetSentence) {
                            setFeedback("Ajoyib! (To'g'ri)");
                            speak(currentLevelData.targetSentence);
                            setIsCorrect(true);
                        } else {
                            setFeedback("Xato. Qayta urinib ko'ring.");
                        }
                    }
                }
            };

            const handleNext = () => {
                if (level < totalLevels - 1) {
                    setLevel(level + 1);
                    setSentence([]);
                    setFeedback("");
                    setIsCorrect(false);
                }
            };

            const handleRestartAll = () => {
                 setLevel(0);
                 setSentence([]);
                 setFeedback("");
                 setIsCorrect(false);
            };

            const reset = () => {
                setSentence([]);
                setFeedback("");
                setIsCorrect(false);
            };

            return (
                <div className="p-4 max-w-4xl mx-auto">
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                        {/* Gap Tuzish Tabs */}
                        <div className="flex border-b border-gray-200 mb-6">
                            <button 
                                onClick={() => handleTabSwitch('tai')}
                                className={`pb-2 px-4 text-lg font-bold transition-colors border-b-2 ${activeTab === 'tai' ? 'border-teal-600 text-teal-600' : 'border-transparent text-gray-400 hover:text-gray-600'}`}
                            >
                                Â§™...‰∫Ü (Tai...le)
                            </button>
                            <button 
                                onClick={() => handleTabSwitch('zenmeyang')}
                                className={`pb-2 px-4 text-lg font-bold transition-colors border-b-2 ${activeTab === 'zenmeyang' ? 'border-teal-600 text-teal-600' : 'border-transparent text-gray-400 hover:text-gray-600'}`}
                            >
                                ...ÊÄé‰πàÊ†∑? (...Zƒõnmey√†ng?)
                            </button>
                        </div>

                        <div className="border-t border-gray-200 pt-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-lg">Gap tuzish (Build the sentence):</h3>
                                <span className="text-sm bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                    Mashq {safeLevel + 1} / {totalLevels}
                                </span>
                            </div>
                            
                            <p className="text-sm text-gray-500 mb-4">
                                Gapni tuzing: <strong>{currentLevelData.hint}</strong>
                            </p>
                            
                            <div className="flex space-x-2 min-h-[60px] bg-gray-100 rounded-lg p-2 mb-4 items-center justify-center">
                                {sentence.map((char, idx) => (
                                    <span key={idx} className="bg-white px-4 py-2 rounded shadow text-xl font-bold animate-pulse">{char}</span>
                                ))}
                                {sentence.length === 0 && <span className="text-gray-400 italic">So'zlarni tanlang...</span>}
                            </div>

                            {feedback && (
                                <div className={`text-center font-bold mb-4 ${feedback.includes("Ajoyib") ? "text-green-600" : "text-red-500"}`}>
                                    {feedback}
                                </div>
                            )}

                            {/* Buttons Area */}
                            {!isCorrect ? (
                                <div className="flex justify-center flex-wrap gap-2">
                                    {currentLevelData.options.map((opt, idx) => (
                                        <button
                                            key={idx}
                                            disabled={sentence.length >= currentLevelData.targetParts.length}
                                            onClick={() => handleAdd(opt.char)}
                                            className="bg-teal-600 hover:bg-teal-700 active:bg-teal-800 text-white px-6 py-2 rounded-lg shadow transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            <div className="flex flex-col items-center justify-center">
                                                {/* Pinyin on Top (Highlighted) */}
                                                <span className="text-xl font-bold mb-1">{opt.pinyin}</span>
                                                {/* Hanzi Below (Smaller) */}
                                                <span className="text-sm font-normal opacity-80">{opt.char}</span>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            ) : (
                                <div className="flex justify-center">
                                    {safeLevel < totalLevels - 1 ? (
                                        <button 
                                            onClick={handleNext}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg text-lg font-bold shadow-lg animate-bounce flex items-center space-x-2"
                                        >
                                            <span>Keyingi mashq (Next)</span>
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                        </button>
                                    ) : (
                                        <div className="flex flex-col items-center">
                                            <div className="bg-green-100 text-green-800 px-6 py-3 rounded-lg font-bold mb-4">
                                                üéâ Tabriklaymiz! Barcha mashqlar bajarildi! (All done!)
                                            </div>
                                            <button 
                                                onClick={handleRestartAll}
                                                className="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2 rounded-lg font-bold shadow transition-colors flex items-center space-x-2"
                                            >
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                                <span>Qayta bajarish (Practice Again)</span>
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {!isCorrect && (
                                <div className="mt-6 text-center">
                                    <button onClick={reset} className="text-gray-500 underline text-sm hover:text-gray-700">Qayta boshlash (Reset)</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const PracticeSection = () => {
            const [questions, setQuestions] = useState([]);
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [isCorrect, setIsCorrect] = useState(null);

            const shuffleArray = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };

            const generateQuiz = () => {
                const shuffledVocab = shuffleArray(vocabulary);
                const newQuestions = shuffledVocab.map((targetItem, index) => {
                    const distractors = vocabulary
                        .filter(v => v.id !== targetItem.id)
                        .sort(() => 0.5 - Math.random()) 
                        .slice(0, 2);
                    const options = shuffleArray([targetItem, ...distractors]);
                    return {
                        id: index,
                        targetId: targetItem.id, 
                        pinyin: targetItem.pinyin,
                        icon: targetItem.icon,
                        options: options
                    };
                });
                setQuestions(newQuestions);
                setScore(0);
                setCurrentQ(0);
                setShowResult(false);
                setIsCorrect(null);
            };

            useEffect(() => {
                generateQuiz();
            }, []);

            const handleAnswer = (option) => {
                if (showResult) return;
                
                const q = questions[currentQ];
                const correct = option.id === q.targetId;
                setIsCorrect(correct);
                
                if (correct) {
                    setScore(score + 1);
                    const correctItem = vocabulary.find(v => v.id === q.targetId);
                    speak(correctItem.char);
                }

                setTimeout(() => {
                    if (currentQ < questions.length - 1) {
                        setCurrentQ(currentQ + 1);
                        setIsCorrect(null);
                    } else {
                        setShowResult(true);
                    }
                }, 1500);
            };

            if (questions.length === 0) return <div className="p-8 text-center text-gray-500">Yuklanmoqda... (Loading...)</div>;

            if (showResult) {
                return (
                    <div className="p-8 max-w-md mx-auto text-center bg-white rounded-xl shadow-lg mt-10">
                        <Icons name="heart" className="w-16 h-16 text-red-500 mx-auto mb-4" />
                        <h2 className="text-2xl font-bold mb-2">Mashq tugadi!</h2>
                        <p className="text-gray-600 mb-6">Sizning natijangiz: {questions.length} tadan {score} ta to'g'ri.</p>
                        <button onClick={generateQuiz} className="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">Qayta ishlash (Restart)</button>
                    </div>
                );
            }

            const q = questions[currentQ];
            const correctVocabItem = vocabulary.find(v => v.id === q.targetId);

            return (
                <div className="p-4 max-w-2xl mx-auto">
                    <div className="bg-white rounded-xl shadow-lg p-6 min-h-[400px] flex flex-col justify-between">
                        <div>
                            <div className="flex justify-between text-sm text-gray-400 mb-4">
                                <span>Savol {currentQ + 1} / {questions.length}</span>
                                <span>Ball: {score}</span>
                            </div>
                            
                            <div className="flex flex-col items-center justify-center mb-8">
                                <div className="w-32 h-32 bg-teal-50 rounded-full flex items-center justify-center border-4 border-teal-100 mb-4 shadow-sm relative overflow-hidden">
                                    <Icons name={q.icon} className={`w-16 h-16 text-teal-600 transition-all duration-500 ${isCorrect ? 'scale-125 text-green-500' : ''}`} />
                                </div>
                                
                                {isCorrect ? (
                                    <div className="animate-bounce text-center">
                                        <h3 className="text-5xl font-bold text-green-600 mb-2">{correctVocabItem.char}</h3>
                                        <p className="text-lg text-gray-400">{q.pinyin}</p>
                                    </div>
                                ) : (
                                    <div className="text-center">
                                        <h3 className="text-4xl font-bold text-gray-800 mb-2">{q.pinyin}</h3>
                                        <p className="text-sm text-gray-400 h-6"> </p>
                                    </div>
                                )}
                                
                                {!isCorrect && (
                                    <button 
                                        onClick={() => speak(q.pinyin)}
                                        className="mt-2 flex items-center space-x-2 text-teal-600 bg-teal-50 px-3 py-1 rounded-full text-sm hover:bg-teal-100 transition-colors"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                                        <span>Tinglash</span>
                                    </button>
                                )}
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {q.options.map((opt, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => handleAnswer(opt)}
                                    className={`p-4 rounded-lg border-2 text-center transition-all font-bold text-lg ${
                                        isCorrect === null 
                                        ? 'border-gray-100 hover:border-teal-500 hover:bg-teal-50 text-gray-700' 
                                        : isCorrect && opt.id === q.targetId 
                                            ? 'border-green-500 bg-green-50 text-green-700' 
                                            : !isCorrect && opt.id === q.targetId 
                                                ? 'border-green-500 bg-green-50 text-green-700' 
                                                : 'border-gray-100 opacity-50 text-gray-400'
                                    }`}
                                >
                                    {opt.uzbek}
                                </button>
                            ))}
                        </div>
                         {isCorrect !== null && (
                            <div className={`text-center mt-4 font-bold ${isCorrect ? 'text-green-600' : 'text-red-500'}`}>
                                {isCorrect ? "To'g'ri! (Correct)" : "Xato! (Wrong)"}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentView, setCurrentView] = useState('vocab');

            return (
                <div className="min-h-screen pb-10">
                    <Header setView={setCurrentView} currentView={currentView} />
                    <main>
                        {currentView === 'vocab' && <VocabularySection />}
                        {currentView === 'dialogue' && <DialogueSection />}
                        {currentView === 'grammar' && <GrammarSection />}
                        {currentView === 'gaptuzish' && <GapTuzishSection />}
                        {currentView === 'practice' && <PracticeSection />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
